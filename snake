using System;
using System.Collections;
using System.Reflection;
using System.Threading;

namespace ConsoleApp5
{
    class Program
    {
        //new game control
        static string upDown = "UpArrow";
        static string input = "null";
        static int menuLine = 1;
        static bool isNewGame = false;
        static bool continueOrNot = false;
        //set gameover state
        static bool isGameOver = false;
        static bool exitTheGame = false;

        //x and y position - snake
        static ArrayList xPosition = new ArrayList();
        static ArrayList yPosition = new ArrayList();
        static int X;
        static int Y;
        static int toDeleteX = 1;
        static int toDeleteY = 1;
        static int speed = 250;
        static int level = 1;
        
        //stearing
        static string keypressed = "RightArrow";
        static char dir = 'r';

        //positions/counter - food
        static Random myRandom = new Random();
        static int counter = 0;
        static ArrayList xPositionFood = new ArrayList();
        static ArrayList yPositionFood = new ArrayList();
        static int gameScore = 0;

        
    
        static void Main(string[] args)
        {
            //make game black on white background
            Console.BackgroundColor = ConsoleColor.White;
            Console.ForegroundColor = ConsoleColor.Black;
            Console.Clear();

            //hide cursor
            Console.CursorVisible = false;

            //window size
            Console.SetWindowSize(80, 24);
            Console.SetBufferSize(80, 24);

            //set initial position
            xPosition.Add(16);//x2
            yPosition.Add(2);//y2

            xPositionFood.Add(-1);
            yPositionFood.Add(-1);


            //draw title
            Console.BackgroundColor = ConsoleColor.DarkGreen;
            Console.ForegroundColor = ConsoleColor.White;
            Console.SetCursorPosition(0, 7);
            Console.WriteLine("                                                                                ");
            Console.SetCursorPosition(0, 8);
            Console.WriteLine("                                                                                ");
            Console.SetCursorPosition(0, 9);
            Console.WriteLine("                                                                                ");

            Console.SetCursorPosition(31, 8);

            Console.Write(" SNAKE THE GAME v1.0");
            Console.BackgroundColor = ConsoleColor.White;
            Console.ForegroundColor = ConsoleColor.Black;



            //draw snake and play the game
            newGame();

            while (true)
            {
                createBattleGround();
                playTheGame();
                if (gameScore == 500)
                    break;
                else
                gameOver();
            }
            Console.Clear();
            Console.SetCursorPosition(36, 11);
            Console.WriteLine("YOU WIN");
            Thread.Sleep(2500);
            exitAnimation();

        }

        public static void newGame()
        {

            while (isNewGame == false)
            {
                if (input.Equals("UpArrow") || input.Equals("DownArrow"))
                    upDown = input;

                if (upDown == "UpArrow")
                {
                    Console.SetCursorPosition(36, 11);
                    Console.BackgroundColor = ConsoleColor.Black;
                    Console.ForegroundColor = ConsoleColor.White;
                    Console.Write(" NEW GAME ");

                    Console.SetCursorPosition(38, 13);
                    Console.BackgroundColor = ConsoleColor.White;
                    Console.ForegroundColor = ConsoleColor.Black;
                    Console.Write(" EXIT ");
                }
                else if (upDown == "DownArrow")
                {
                    Console.SetCursorPosition(36, 11);
                    Console.BackgroundColor = ConsoleColor.White;
                    Console.ForegroundColor = ConsoleColor.Black;
                    Console.Write(" NEW GAME ");

                    Console.SetCursorPosition(38, 13);
                    Console.BackgroundColor = ConsoleColor.Black;
                    Console.ForegroundColor = ConsoleColor.White;
                    Console.Write(" EXIT ");

                    Console.BackgroundColor = ConsoleColor.White;
                    Console.ForegroundColor = ConsoleColor.Black;
                }
                Console.ForegroundColor = ConsoleColor.White;
                input = Convert.ToString(Console.ReadKey().Key);
                if (upDown.Equals("UpArrow") && input.Equals("Enter"))
                {
                    Console.ForegroundColor = ConsoleColor.Black;
                    isNewGame = true;
                    newGameAnimation();
                    break;

                }

                else if (upDown.Equals("DownArrow") && input.Equals("Enter"))
                {
                    exitAnimation();
                    Environment.Exit(0);
                }

            }
            isNewGame = true;
        }
        public static void newGameAnimation()
        {
            Console.BackgroundColor = ConsoleColor.Black;
            Console.ForegroundColor = ConsoleColor.White;
            for (int i = 0; i < Console.WindowHeight; i++)
            {
                Console.SetCursorPosition(0, i);
                Console.WriteLine("                                                                                ");
                Thread.Sleep(4);
            }
            Console.Clear();

            Console.SetCursorPosition(35, 10);
            Console.WriteLine("OK LET'S GO");
            Thread.Sleep(1100);

            Console.BackgroundColor = ConsoleColor.White;
            Console.ForegroundColor = ConsoleColor.Black;
            for (int i = 0; i < Console.WindowHeight; i++)
            {
                Console.WriteLine("                                                                                ");
                Thread.Sleep(5);
            }
        }
        public static void createBattleGround()
        {
            //make battleground
            for (int i = 16; i < 65; i++)
            {

                Console.SetCursorPosition(i, 1);
                Console.Write("═");
                Console.SetCursorPosition(i, 22);
                Console.Write("═");
            }
            for (int n = 2; n < 22; n++)
            {
                Console.SetCursorPosition(15, n);
                Console.Write("║");
                Console.SetCursorPosition(65, n);
                Console.Write("║");
            }
            Console.SetCursorPosition(15, 1);
            Console.WriteLine("╔");
            Console.SetCursorPosition(65, 1);
            Console.WriteLine("╗");
            Console.SetCursorPosition(15, 22);
            Console.WriteLine("╚");
            Console.SetCursorPosition(65, 22);
            Console.WriteLine("╝");

            //score + level + info panel
            Console.SetCursorPosition(3, 1);
            Console.Write("SCORE: ");
            Console.SetCursorPosition(3, 3);
            Console.Write("LEVEL: ");
            Console.SetCursorPosition(36, 0);
            Console.Write("Snake v1.0");
            Console.SetCursorPosition(67, 1);
            Console.Write("USE ARROWS");
            Console.SetCursorPosition(67, 2);
            Console.Write("TO CONTROL");
            Console.SetCursorPosition(67, 3);
            Console.Write("SNAKE");

            Console.SetCursorPosition(67, 5);
            Console.Write("USE SPACEBAR");
            Console.SetCursorPosition(67, 6);
            Console.Write("TO PAUSE");
        }
        public static void playTheGame()
        {
            exitTheGame = false;

            //set initial position of head (ín case of new game)
            xPosition[0] = 16;
            yPosition[0] = 2;

            //set for new head position
            X = (int)xPosition[0];
            Y = (int)yPosition[0];

            

            do
            {

                levels();
                Console.ForegroundColor = ConsoleColor.Black;


                //score / level update
                Console.SetCursorPosition(10, 1);
                Console.WriteLine(gameScore);
                Console.SetCursorPosition(10, 3);
                Console.WriteLine(level);


                //draw food in battleground
                food();
                //draw body  (xPosition length = yPosition length)
                for (int i = 0; i < xPosition.Count; i++)
                {
                    if (i == 0)
                    {
                        Console.SetCursorPosition((int)xPosition[i], (int)yPosition[i]);
                        Console.Write("O");
                    }
                    else
                    {
                        Console.SetCursorPosition((int)xPosition[i], (int)yPosition[i]);
                        Console.Write("o");
                    }

                }
                Console.ForegroundColor = ConsoleColor.White;

                //set postion of last bodypart to delete
                toDeleteX = (int)xPosition[xPosition.Count - 1];
                toDeleteY = (int)yPosition[yPosition.Count - 1];


                //move bodyparts positions to new coords
                for (int n = xPosition.Count - 1; n > 0; n--)
                {
                    xPosition[n] = xPosition[n - 1];
                    yPosition[n] = yPosition[n - 1];

                };


                //game speed
                Thread.Sleep(speed);

                //wall hit check + win check
                if ((int)xPosition[0] != 65 && (int)xPosition[0] != 15 && (int)yPosition[0] != 22 && (int)yPosition[0] != 1 && gameScore!=500)
                {

                    //delete the last bodypart or make snake longer
                    eatCheck();
                    //check if game is paused and pause/unpause the game
                    gamepause();
                    //set direction by arrow keys
                    stearing();
                    //move in direction 
                    direction();

                    //set new position for head
                    xPosition[0] = X;
                    yPosition[0] = Y;

                    //check if snake didn't byte himself
                    for (int b = 1; b < xPosition.Count; b++)
                    {

                        if (((int)xPosition[0] == (int)xPosition[b]) && ((int)yPosition[0] == (int)yPosition[b]))
                        {
                            exitTheGame = true;
                            Console.ForegroundColor = ConsoleColor.Black;
                            break;
                        }

                    }

                }
                else
                {

                    exitTheGame = true;
                    Console.ForegroundColor = ConsoleColor.Black;
                    break;
                }

            }
            while (!exitTheGame);
        }

        public static void stearing()
        {
           if (Console.KeyAvailable == true)
           {
                keypressed = Convert.ToString(Console.ReadKey().Key);
           }
        }
        public static void direction()
        {
            if (keypressed.Equals("RightArrow"))
            {
                if (dir != 'l')
                {
                    X++;
                    dir = 'r';
                }
                else
                {
                    X--;
                }
            }
            else if (keypressed.Equals("LeftArrow"))
            {
                if (dir != 'r')
                {
                    X--;
                    dir = 'l';
                }
                else
                {
                    X++;
                }
            }
            else if (keypressed.Equals("DownArrow"))
            {
                if (dir != 'u')
                {
                    Y++;
                    dir = 'd';
                }
                else
                {
                    Y--;
                }
            }
            else if (keypressed.Equals("UpArrow"))
            {
                if(dir != 'd')
                {
                    Y--;
                    dir = 'u';
                }
                else
                {
                    Y++;
                }
            }
            //disable wrong input
            else if (keypressed != "UpArrow" || keypressed != "DownArrow" || keypressed != "RightArrow" || keypressed != "LeftArrow")
            {
                
                if (dir == 'r')
                    X++;
                else if (dir == 'l')
                    X--;
                else if (dir == 'u')
                    Y--;
                else if (dir == 'd')
                    Y++;
            }
        }
        
        public static void food()
        {
            counter++;
            //check if snake ate the food
            for (int i = 0; i < xPositionFood.Count; i++)
            {
                if ((int)xPosition[0] == (int)xPositionFood[i] && (int)yPosition[0] == (int)yPositionFood[i])
                {
                    counter = 0;
                }
            }

            //generate next food at random place
            if (counter == 2)
            {
                xPositionFood[0]=(int)myRandom.Next(16, 64);
                yPositionFood[0]=(int)myRandom.Next(2, 21);

                Console.SetCursorPosition((int)xPositionFood[xPositionFood.Count - 1], (int)yPositionFood[yPositionFood.Count - 1]);
                Console.Write("@");

            }
        }
        public static void eatCheck()
        {
            //check if the snake ate the food and add body
                if ((int)xPosition[0] == (int)xPositionFood[0] && (int)yPosition[0] == (int)yPositionFood[0])
                {

                    int tempX = (int)xPosition[xPosition.Count - 1];
                    int tempY = (int)yPosition[yPosition.Count - 1];

                    xPosition.Add(tempX);
                    yPosition.Add(tempY);
                    gameScore += 10;

                }
                //delete last bodypart
                Console.SetCursorPosition(toDeleteX, toDeleteY);
                Console.Write(" ");
        }
        public static void levels()
        {
            if (gameScore < 100)
            {
                level = 1;
                speed = 250;
            }
            else if (gameScore == 100)
            {
                level = 2;
                speed = 200;
            }
            else if (gameScore == 200)
            {
                level = 3;
                speed = 150;
            }
            else if (gameScore == 300)
            {
                level = 4;
                speed = 100;
            }
            else if (gameScore == 400)
            {
                level = 5;
                speed = 70;
            }
        }
        
        public static void gamepause()
        {
            while (keypressed == "Spacebar")
            {
                //Clear the game board
                for (int i = 2; i < 22; i++)
                {
                    Console.SetCursorPosition(16, i);
                    Console.WriteLine("                                                 ");
                }


                Console.BackgroundColor = ConsoleColor.DarkRed;
                Console.SetCursorPosition(16, 7);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 8);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 9);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(38, 8);
                Console.ForegroundColor = ConsoleColor.White;
                Console.WriteLine("PAUSED!");
                Console.ForegroundColor = ConsoleColor.Black;
                Console.BackgroundColor = ConsoleColor.White;

                while (!continueOrNot)
                {
                    switch (menuLine)
                    {
                        case 1:
                            Console.SetCursorPosition(36, 11);
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.White;
                            Console.Write(" CONTINUE ");

                            Console.SetCursorPosition(37, 13);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" RESTART ");

                            Console.SetCursorPosition(38, 15);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" EXIT ");

                            break;

                        case 2:
                            Console.SetCursorPosition(36, 11);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" CONTINUE ");

                            Console.SetCursorPosition(37, 13);
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.White;
                            Console.Write(" RESTART ");

                            Console.SetCursorPosition(38, 15);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" EXIT ");

                            break;

                        case 3:
                            Console.SetCursorPosition(36, 11);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" CONTINUE ");

                            Console.SetCursorPosition(37, 13);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" RESTART ");

                            Console.SetCursorPosition(38, 15);
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.White;
                            Console.Write(" EXIT ");
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;


                            break;
                    }

                    input = Convert.ToString(Console.ReadKey().Key);

                    if (input.Equals("UpArrow") && menuLine > 1)
                    {
                        menuLine--;
                        if (menuLine < 1)
                            menuLine = 1;
                    }

                    else if (input.Equals("DownArrow") && menuLine < 3)
                    {
                        menuLine++;
                        if (menuLine > 3)
                            menuLine = 3;
                    }


                    if (menuLine == 1 && input == "Enter")
                    {
                        continueOrNot = true;

                        Console.SetCursorPosition((int)xPositionFood[xPositionFood.Count - 1], (int)yPositionFood[yPositionFood.Count - 1]);
                        Console.Write("@");
                    }

                    else if (menuLine == 2 && input == "Enter")
                    {
                        Console.SetCursorPosition(10, 1);
                        Console.WriteLine("   ");
                        Console.SetCursorPosition(10, 3);
                        Console.WriteLine("   ");

                        gameScore = 0;
                        level = 1;
                        speed = 250;

                        //clear snake's bodyparts from game board
                        for (int d = xPosition.Count - 1; d >= 0; d--)
                        {
                            Console.SetCursorPosition((int)xPosition[d], (int)yPosition[d]);
                            Console.Write(" ");
                        }
                        //delete snake's bodyparts
                        for (int i = xPosition.Count - 1; i > 0; i--)
                        {
                            xPosition.RemoveAt(i);
                            yPosition.RemoveAt(i);
                        }
                        //set the start position - setting
                        X = 16;
                        Y = 2;
                        dir = 'r';
                        keypressed = "RightArrow";
                        continueOrNot = true;
                        counter = 0;

                    }

                    else if (menuLine == 3 && input == "Enter")
                    {
                        exitAnimation();
                        Environment.Exit(0);
                    }

                    Console.SetCursorPosition(36, 11);
                    Console.WriteLine("           ");
                    Console.SetCursorPosition(37, 13);
                    Console.WriteLine("           ");
                    Console.SetCursorPosition(38, 15);
                    Console.WriteLine("           ");
                }

                Console.SetCursorPosition(16, 7);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 8);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 9);
                Console.WriteLine("                                                 ");

                Console.BackgroundColor = ConsoleColor.White;
                keypressed = "";
                Console.SetCursorPosition(38, 8);
                Console.WriteLine("        ");
                Console.ForegroundColor = ConsoleColor.White;
                continueOrNot = false;
            }

        }
        public static void gameOver()
        {
           
            isGameOver = true;

            while (isGameOver)
            {
                //Clear the game board
                for (int i = 2; i < 22; i++)
                {
                    Console.SetCursorPosition(16, i);
                    Console.WriteLine("                                                 ");
                }


                Console.BackgroundColor = ConsoleColor.Red;
                Console.SetCursorPosition(16, 7);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 8);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 9);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(38, 8);
                Console.ForegroundColor = ConsoleColor.White;
                Console.WriteLine("GAME OVER");
                Console.ForegroundColor = ConsoleColor.Black;
                Console.BackgroundColor = ConsoleColor.White;

                while (!continueOrNot)
                {
                    switch (menuLine)
                    {
                        case 1:
                            Console.SetCursorPosition(37, 13);
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.White;
                            Console.Write(" RESTART ");

                            Console.SetCursorPosition(38, 15);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" EXIT ");

                            break;

                        case 2:
                            Console.SetCursorPosition(37, 13);
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;
                            Console.Write(" RESTART ");

                            Console.SetCursorPosition(38, 15);
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.White;
                            Console.Write(" EXIT ");
                            Console.BackgroundColor = ConsoleColor.White;
                            Console.ForegroundColor = ConsoleColor.Black;


                            break;
                    }

                    input = Convert.ToString(Console.ReadKey().Key);

                    if (input.Equals("UpArrow") && menuLine > 1)
                    {
                        menuLine--;
                        if (menuLine < 1)
                            menuLine = 1;
                    }

                    else if (input.Equals("DownArrow") && menuLine < 2)
                    {
                        menuLine++;
                        if (menuLine > 2)
                            menuLine = 2;
                    }

                    if (menuLine == 1 && input == "Enter")
                    {
                        Console.SetCursorPosition(10, 1);
                        Console.WriteLine("   ");
                        Console.SetCursorPosition(10, 3);
                        Console.WriteLine("   ");

                        gameScore = 0;
                        level = 1;
                        speed = 250;

                        //delete snake's bodyparts
                        for (int i = xPosition.Count - 1; i > 0; i--)
                        {
                            xPosition.RemoveAt(i);
                            yPosition.RemoveAt(i);
                        }

                        
                        dir = 'r';
                        keypressed = "RightArrow";
                        counter = 0;

                        continueOrNot = true;




                    }

                    else if (menuLine == 2 && input == "Enter")
                    {
                        exitAnimation();
                        Environment.Exit(0);
                    }


                }


                Console.BackgroundColor = ConsoleColor.White;
                keypressed = "";
                Console.SetCursorPosition(38, 8);
                Console.WriteLine("        ");
                Console.ForegroundColor = ConsoleColor.White;

                Console.SetCursorPosition(37, 13);
                Console.WriteLine("           ");
                Console.SetCursorPosition(38, 15);
                Console.WriteLine("           ");

                Console.SetCursorPosition(16, 7);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 8);
                Console.WriteLine("                                                 ");
                Console.SetCursorPosition(16, 9);
                Console.WriteLine("                                                 ");

                Console.ForegroundColor = ConsoleColor.Black;
                continueOrNot = false;

                isGameOver = false;
                
            }


        }
        
        public static void exitAnimation()
        {
            Console.BackgroundColor = ConsoleColor.Black;
            Console.ForegroundColor = ConsoleColor.White;
            for (int i = 0; i < Console.WindowHeight; i++)
            {
                Console.SetCursorPosition(0, i);
                Console.WriteLine("                                                                                ");
                Thread.Sleep(4);
            }
            Console.Clear();

            Console.SetCursorPosition(26, 10);
            Console.WriteLine("THANK YOU FOR PLAYING THIS GAME");
            Thread.Sleep(2000);

            for (int i = 26; i < 60; i++)
            {
                Console.SetCursorPosition(i, 10);
                Console.Write(" ");
                Thread.Sleep(5);
            }

            Thread.Sleep(1000);
        }
        

    }

    
}
